#!/usr/bin/env ruby

require_relative '../config/environment'

begin
  rpc = RpcProvider.new(Books.rabbitmq_config)
  rpc.register_queue('book-shop.books.authors.list') do
    Author.all.map(&:name).to_s
  end
  puts 'Listening... (press Ctrl-C to stop)'
  loop { sleep 10 }
rescue Interrupt => error
  puts 'Shutting down...'
  rpc.close
  ActiveRecord::Base.remove_connection
  exit 0
end
