#!/usr/bin/env ruby

require_relative '../config/environment'
rabbitmq_config = YAML.load_file('config/database.yml')[APP_ENV]

begin
  rpc = RpcProvider.new(rabbitmq_config)
  rpc.register_queue('book-shop.books.authors.list') do
    Author.all.map(&:name).to_s
  end
  puts 'Listening... (press Ctrl-C to stop)'
  loop { sleep 10 }
rescue Interrupt => error
  rpc.close
  raise error
end
